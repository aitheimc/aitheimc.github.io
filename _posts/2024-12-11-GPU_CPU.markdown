---
layout: post
title:  "서버 메모리 터짐 현상 관련 정보"
date:   2024-12-11 17:05:01 +0900
author: Kimyh
excerpt_separator: "<!--more-->"
tags:
    - guide
    - markdown
    - rule
---

서버 메모리 터짐 현상이 발생하였을시 조치 방법입니다.

<!--more-->

# 1. GPU 메모리 확인

가장 기본적인 원인으로, AI 학습 등을 진행하면서 GPU 메모리가 감당 할 수 없을 만큼의 연산메모리를 사용하여 발생하는 경우

```bash 
nvidia-smi
watch -n 1 nivida-smi # (1초에 한번씩 계속 보여줌)
```

GPU 메모리 사용을 확인 가능한 터미널 명령어를 통해 사용량을 확인하고 적절한 데이터입력 batch 등을 고려해야함

# 2. CPU 메모리 확인

GPU 메모리 등에 문제가 없을 경우, 두 번째 파악해야하는 영역.

CPU 메모리는 대개 과한 매개 변수 생성 또는 특정 type 의 변수에 값이 과하게 축적되어 해당 변수의 메모리 자체가 서버가 감당할 수 없을 정도로 비대해지는 경우 발생함.

### 2-1. python 코드

- 메모리 확인 python 코드

```python
import psutil

def print_memory_usage():
    memory_info = psutil.virtual_memory()
    cpu_use = memory_info.percent
    memory_avail = memory_info.available / (1024 ** 3)
    print(f'CPU Memory Usage: {cpu_use}% Used, {memory_avail:.2f} GB available')
```



### 2-2. 예시

1.  list 와 같은 데이터를 저장가능한 변수에 과하게 많은 값이 축적되는 경우

list 변수에 들어가는 값 또한 메모리를 사용하게 되어 무한대로 축적하는 것은 불가능함

```python
for i in range(epohcs):
    pred_list = []
    for x, y in dataloader:
        pred = model(x)
        pred_list.append(pred)
```

2. matplotlib

그래프를 그리는 대표적인 이미지 패키지 matplotlib 를 활용할때

```python
plt.close(fig)
```

위와 같이 fig 를 close 해주지 않으면 같은 fig 를 생성해도 이전에 생성된 figure 가 사라지지 않아 메모리가 계속 축적됨